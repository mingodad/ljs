/* Generated by re2c 1.3 on Sun Jan  3 19:13:58 2021 */
#line 1 "lua-parser.re2c"
typedef struct LuaScanner {
  char *top, *last_top, *cur, *ptr, *pos, *limit;
  int line;
#ifndef NDEBUG
  char parsePrompt[32];
#endif
} LuaScanner;

#define   YYCTYPE     unsigned char
#define   YYCURSOR    s->cur
#define   YYMARKER    s->ptr
#define   YYLIMIT    s->limit

static void processNewLine(LuaScanner* s)
{
  //printf("%d:%.25s\n", s->line, s->top);
  s->pos = s->cur;
  s->line++;
#ifndef NDEBUG
  snprintf(s->parsePrompt, sizeof(s->parsePrompt), "parser %d >>", s->line);
#endif
}

static int scan(LuaScanner* s, char *buff_end) {

  int nest_count = 0, quote_size = 0, long_start_line;
  char *long_top;

regular:
  if (s->cur >= buff_end) {
    return TK_THEEND;
  }
  s->top = s->cur;

#line 65 "lua-parser.re2c"



#line 42 "lua-parser.re2c.c"
{
	YYCTYPE yych;
	unsigned int yyaccept = 0;
	yych = *YYCURSOR;
	switch (yych) {
	case 0x00:	goto yy2;
	case '\t':
	case '\v':
	case '\f':
	case '\r':
	case ' ':	goto yy6;
	case '\n':	goto yy8;
	case '"':	goto yy10;
	case '#':	goto yy11;
	case '%':	goto yy13;
	case '&':	goto yy15;
	case '\'':	goto yy17;
	case '(':	goto yy18;
	case ')':	goto yy20;
	case '*':	goto yy22;
	case '+':	goto yy24;
	case ',':	goto yy26;
	case '-':	goto yy28;
	case '.':	goto yy30;
	case '/':	goto yy32;
	case '0':	goto yy34;
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy36;
	case ':':	goto yy38;
	case ';':	goto yy40;
	case '<':	goto yy42;
	case '=':	goto yy44;
	case '>':	goto yy46;
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'c':
	case 'h':
	case 'j':
	case 'k':
	case 'm':
	case 'p':
	case 'q':
	case 's':
	case 'v':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	case '[':	goto yy51;
	case ']':	goto yy53;
	case '^':	goto yy55;
	case 'a':	goto yy57;
	case 'b':	goto yy58;
	case 'd':	goto yy59;
	case 'e':	goto yy60;
	case 'f':	goto yy61;
	case 'g':	goto yy62;
	case 'i':	goto yy63;
	case 'l':	goto yy64;
	case 'n':	goto yy65;
	case 'o':	goto yy66;
	case 'r':	goto yy67;
	case 't':	goto yy68;
	case 'u':	goto yy69;
	case 'w':	goto yy70;
	case '{':	goto yy71;
	case '|':	goto yy73;
	case '}':	goto yy75;
	case '~':	goto yy77;
	default:	goto yy4;
	}
yy2:
	++YYCURSOR;
#line 167 "lua-parser.re2c"
	{ goto regular; }
#line 149 "lua-parser.re2c.c"
yy4:
	++YYCURSOR;
yy5:
#line 161 "lua-parser.re2c"
	{ fprintf(stderr, "unexpected character: '%c' at line %d:%d\n",
                        *s->cur, s->line, (int)(s->cur - s->pos));
                        exit(1);
                    }
#line 158 "lua-parser.re2c.c"
yy6:
	++YYCURSOR;
#line 71 "lua-parser.re2c"
	{ goto regular; }
#line 163 "lua-parser.re2c.c"
yy8:
	++YYCURSOR;
#line 70 "lua-parser.re2c"
	{ processNewLine(s); goto regular; }
#line 168 "lua-parser.re2c.c"
yy10:
	yyaccept = 0;
	yych = *(YYMARKER = ++YYCURSOR);
	if (yych <= 0x00) goto yy5;
	goto yy80;
yy11:
	yych = *++YYCURSOR;
	switch (yych) {
	case '!':	goto yy85;
	default:	goto yy12;
	}
yy12:
#line 109 "lua-parser.re2c"
	{ return TK_LEN; }
#line 183 "lua-parser.re2c.c"
yy13:
	++YYCURSOR;
#line 107 "lua-parser.re2c"
	{ return TK_MOD; }
#line 188 "lua-parser.re2c.c"
yy15:
	++YYCURSOR;
#line 128 "lua-parser.re2c"
	{ return TK_BITAND; }
#line 193 "lua-parser.re2c.c"
yy17:
	yyaccept = 0;
	yych = *(YYMARKER = ++YYCURSOR);
	if (yych <= 0x00) goto yy5;
	goto yy89;
yy18:
	++YYCURSOR;
#line 137 "lua-parser.re2c"
	{ return TK_LPAREN; }
#line 203 "lua-parser.re2c.c"
yy20:
	++YYCURSOR;
#line 138 "lua-parser.re2c"
	{ return TK_RPAREN; }
#line 208 "lua-parser.re2c.c"
yy22:
	++YYCURSOR;
#line 106 "lua-parser.re2c"
	{ return TK_MUL; }
#line 213 "lua-parser.re2c.c"
yy24:
	++YYCURSOR;
#line 103 "lua-parser.re2c"
	{ return TK_PLUS; }
#line 218 "lua-parser.re2c.c"
yy26:
	++YYCURSOR;
#line 114 "lua-parser.re2c"
	{ return TK_COMMA; }
#line 223 "lua-parser.re2c.c"
yy28:
	yych = *++YYCURSOR;
	switch (yych) {
	case '-':	goto yy93;
	default:	goto yy29;
	}
yy29:
#line 104 "lua-parser.re2c"
	{ return TK_MINUS; }
#line 233 "lua-parser.re2c.c"
yy30:
	yych = *++YYCURSOR;
	switch (yych) {
	case '.':	goto yy95;
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy97;
	default:	goto yy31;
	}
yy31:
#line 136 "lua-parser.re2c"
	{ return TK_DOT; }
#line 253 "lua-parser.re2c.c"
yy32:
	yych = *++YYCURSOR;
	switch (yych) {
	case '/':	goto yy99;
	default:	goto yy33;
	}
yy33:
#line 105 "lua-parser.re2c"
	{ return TK_DIV; }
#line 263 "lua-parser.re2c.c"
yy34:
	yyaccept = 1;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case 'X':
	case 'x':	goto yy105;
	default:	goto yy37;
	}
yy35:
#line 149 "lua-parser.re2c"
	{ return TK_NUMBER; }
#line 275 "lua-parser.re2c.c"
yy36:
	yyaccept = 1;
	yych = *(YYMARKER = ++YYCURSOR);
yy37:
	switch (yych) {
	case '.':	goto yy101;
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy36;
	case 'E':
	case 'e':	goto yy102;
	case 'L':	goto yy103;
	case 'U':	goto yy104;
	case 'l':	goto yy106;
	case 'u':	goto yy107;
	default:	goto yy35;
	}
yy38:
	yyaccept = 2;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case ':':	goto yy108;
	default:	goto yy39;
	}
yy39:
#line 135 "lua-parser.re2c"
	{ return TK_COLON; }
#line 310 "lua-parser.re2c.c"
yy40:
	++YYCURSOR;
#line 134 "lua-parser.re2c"
	{ return TK_SEMICOLON; }
#line 315 "lua-parser.re2c.c"
yy42:
	yych = *++YYCURSOR;
	switch (yych) {
	case '<':	goto yy109;
	case '=':	goto yy111;
	default:	goto yy43;
	}
yy43:
#line 112 "lua-parser.re2c"
	{ return TK_LT; }
#line 326 "lua-parser.re2c.c"
yy44:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy113;
	default:	goto yy45;
	}
yy45:
#line 102 "lua-parser.re2c"
	{ return TK_ASSIGN; }
#line 336 "lua-parser.re2c.c"
yy46:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy115;
	case '>':	goto yy117;
	default:	goto yy47;
	}
yy47:
#line 113 "lua-parser.re2c"
	{ return TK_BT; }
#line 347 "lua-parser.re2c.c"
yy48:
	yych = *++YYCURSOR;
yy49:
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy50;
	}
yy50:
#line 146 "lua-parser.re2c"
	{ return TK_NAME; }
#line 420 "lua-parser.re2c.c"
yy51:
	yyaccept = 3;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy119;
	case '[':	goto yy121;
	default:	goto yy52;
	}
yy52:
#line 141 "lua-parser.re2c"
	{ return TK_LBRACKET; }
#line 432 "lua-parser.re2c.c"
yy53:
	++YYCURSOR;
#line 142 "lua-parser.re2c"
	{ return TK_RBRACKET; }
#line 437 "lua-parser.re2c.c"
yy55:
	++YYCURSOR;
#line 108 "lua-parser.re2c"
	{ return TK_POW; }
#line 442 "lua-parser.re2c.c"
yy57:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy123;
	default:	goto yy49;
	}
yy58:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'r':	goto yy124;
	default:	goto yy49;
	}
yy59:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy125;
	default:	goto yy49;
	}
yy60:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy127;
	case 'n':	goto yy128;
	default:	goto yy49;
	}
yy61:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'a':	goto yy129;
	case 'o':	goto yy130;
	case 'u':	goto yy131;
	default:	goto yy49;
	}
yy62:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy132;
	default:	goto yy49;
	}
yy63:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'f':	goto yy133;
	case 'n':	goto yy135;
	default:	goto yy49;
	}
yy64:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy137;
	default:	goto yy49;
	}
yy65:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'i':	goto yy138;
	case 'o':	goto yy139;
	default:	goto yy49;
	}
yy66:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'r':	goto yy140;
	default:	goto yy49;
	}
yy67:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy142;
	default:	goto yy49;
	}
yy68:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'h':	goto yy143;
	case 'r':	goto yy144;
	default:	goto yy49;
	}
yy69:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy145;
	default:	goto yy49;
	}
yy70:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'h':	goto yy146;
	default:	goto yy49;
	}
yy71:
	++YYCURSOR;
#line 139 "lua-parser.re2c"
	{ return TK_LBRACE; }
#line 537 "lua-parser.re2c.c"
yy73:
	++YYCURSOR;
#line 127 "lua-parser.re2c"
	{ return TK_BITOR; }
#line 542 "lua-parser.re2c.c"
yy75:
	++YYCURSOR;
#line 140 "lua-parser.re2c"
	{ return TK_RBRACE; }
#line 547 "lua-parser.re2c.c"
yy77:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy147;
	default:	goto yy78;
	}
yy78:
#line 126 "lua-parser.re2c"
	{ return TK_BITNOT; }
#line 557 "lua-parser.re2c.c"
yy79:
	yych = *++YYCURSOR;
yy80:
	switch (yych) {
	case 0x00:	goto yy81;
	case '"':	goto yy82;
	case '\\':	goto yy84;
	default:	goto yy79;
	}
yy81:
	YYCURSOR = YYMARKER;
	switch (yyaccept) {
	case 0: 	goto yy5;
	case 1: 	goto yy35;
	case 2: 	goto yy39;
	case 3: 	goto yy52;
	case 4: 	goto yy94;
	default:	goto yy162;
	}
yy82:
	++YYCURSOR;
#line 154 "lua-parser.re2c"
	{ return TK_STRING; }
#line 581 "lua-parser.re2c.c"
yy84:
	yych = *++YYCURSOR;
	if (yych <= 0x00) goto yy81;
	goto yy79;
yy85:
	yych = *++YYCURSOR;
	switch (yych) {
	case 0x00:
	case '\n':	goto yy87;
	default:	goto yy85;
	}
yy87:
#line 157 "lua-parser.re2c"
	{ goto regular; }
#line 596 "lua-parser.re2c.c"
yy88:
	yych = *++YYCURSOR;
yy89:
	switch (yych) {
	case 0x00:	goto yy81;
	case '\'':	goto yy90;
	case '\\':	goto yy92;
	default:	goto yy88;
	}
yy90:
	++YYCURSOR;
#line 153 "lua-parser.re2c"
	{ return TK_STRING; }
#line 610 "lua-parser.re2c.c"
yy92:
	yych = *++YYCURSOR;
	if (yych <= 0x00) goto yy81;
	goto yy88;
yy93:
	yyaccept = 4;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '[':	goto yy149;
	default:	goto yy94;
	}
yy94:
#line 75 "lua-parser.re2c"
	{ goto Comment; }
#line 625 "lua-parser.re2c.c"
yy95:
	yych = *++YYCURSOR;
	switch (yych) {
	case '.':	goto yy151;
	default:	goto yy96;
	}
yy96:
#line 111 "lua-parser.re2c"
	{ return TK_CONCAT; }
#line 635 "lua-parser.re2c.c"
yy97:
	yyaccept = 1;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy97;
	case 'E':
	case 'e':	goto yy102;
	default:	goto yy35;
	}
yy99:
	++YYCURSOR;
#line 122 "lua-parser.re2c"
	{ return TK_IDIV; }
#line 658 "lua-parser.re2c.c"
yy101:
	yyaccept = 1;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case 'i':	goto yy35;
	default:	goto yy154;
	}
yy102:
	yych = *++YYCURSOR;
	switch (yych) {
	case '+':
	case '-':	goto yy155;
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy156;
	default:	goto yy81;
	}
yy103:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'L':	goto yy158;
	default:	goto yy81;
	}
yy104:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'L':	goto yy103;
	default:	goto yy81;
	}
yy105:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':	goto yy160;
	default:	goto yy81;
	}
yy106:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy158;
	default:	goto yy81;
	}
yy107:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy106;
	default:	goto yy81;
	}
yy108:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case ':':	goto yy81;
	default:	goto yy164;
	}
yy109:
	++YYCURSOR;
#line 129 "lua-parser.re2c"
	{ return TK_SHL; }
#line 754 "lua-parser.re2c.c"
yy111:
	++YYCURSOR;
#line 117 "lua-parser.re2c"
	{ return TK_LTEQ; }
#line 759 "lua-parser.re2c.c"
yy113:
	++YYCURSOR;
#line 115 "lua-parser.re2c"
	{ return TK_EQ; }
#line 764 "lua-parser.re2c.c"
yy115:
	++YYCURSOR;
#line 116 "lua-parser.re2c"
	{ return TK_BTEQ; }
#line 769 "lua-parser.re2c.c"
yy117:
	++YYCURSOR;
#line 130 "lua-parser.re2c"
	{ return TK_SHR; }
#line 774 "lua-parser.re2c.c"
yy119:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy119;
	case '[':	goto yy121;
	default:	goto yy81;
	}
yy121:
	++YYCURSOR;
#line 143 "lua-parser.re2c"
	{ long_start_line = s->line; nest_count=0; quote_size = (int)(s->cur - s->top); goto LongString; }
#line 786 "lua-parser.re2c.c"
yy123:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'd':	goto yy165;
	default:	goto yy49;
	}
yy124:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy167;
	default:	goto yy49;
	}
yy125:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy126;
	}
yy126:
#line 80 "lua-parser.re2c"
	{ return TK_DO; }
#line 870 "lua-parser.re2c.c"
yy127:
	yych = *++YYCURSOR;
	switch (yych) {
	case 's':	goto yy168;
	default:	goto yy49;
	}
yy128:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'd':	goto yy169;
	default:	goto yy49;
	}
yy129:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy171;
	default:	goto yy49;
	}
yy130:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'r':	goto yy172;
	default:	goto yy49;
	}
yy131:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy174;
	default:	goto yy49;
	}
yy132:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy175;
	default:	goto yy49;
	}
yy133:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy134;
	}
yy134:
#line 88 "lua-parser.re2c"
	{ return TK_IF; }
#line 978 "lua-parser.re2c.c"
yy135:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy136;
	}
yy136:
#line 89 "lua-parser.re2c"
	{ return TK_IN; }
#line 1050 "lua-parser.re2c.c"
yy137:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'c':	goto yy176;
	default:	goto yy49;
	}
yy138:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy177;
	default:	goto yy49;
	}
yy139:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy179;
	default:	goto yy49;
	}
yy140:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy141;
	}
yy141:
#line 93 "lua-parser.re2c"
	{ return TK_OR; }
#line 1140 "lua-parser.re2c.c"
yy142:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'p':	goto yy181;
	case 't':	goto yy182;
	default:	goto yy49;
	}
yy143:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy183;
	default:	goto yy49;
	}
yy144:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'u':	goto yy184;
	default:	goto yy49;
	}
yy145:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy185;
	default:	goto yy49;
	}
yy146:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'i':	goto yy186;
	default:	goto yy49;
	}
yy147:
	++YYCURSOR;
#line 118 "lua-parser.re2c"
	{ return TK_NEQ; }
#line 1176 "lua-parser.re2c.c"
yy149:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy149;
	case '[':	goto yy187;
	default:	goto yy81;
	}
yy151:
	++YYCURSOR;
#line 110 "lua-parser.re2c"
	{ return TK_ELLIPSIS; }
#line 1188 "lua-parser.re2c.c"
yy153:
	yyaccept = 1;
	yych = *(YYMARKER = ++YYCURSOR);
yy154:
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy153;
	case 'E':
	case 'e':	goto yy102;
	case 'i':	goto yy189;
	default:	goto yy35;
	}
yy155:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy156;
	default:	goto yy81;
	}
yy156:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy156;
	default:	goto yy35;
	}
yy158:
	++YYCURSOR;
#line 150 "lua-parser.re2c"
	{ return TK_NUMBER; }
#line 1243 "lua-parser.re2c.c"
yy160:
	yyaccept = 5;
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':	goto yy160;
	case 'L':	goto yy191;
	case 'P':
	case 'p':	goto yy192;
	case 'U':	goto yy193;
	case 'l':	goto yy194;
	case 'u':	goto yy195;
	default:	goto yy162;
	}
yy162:
#line 151 "lua-parser.re2c"
	{ return TK_NUMBER; }
#line 1281 "lua-parser.re2c.c"
yy163:
	yych = *++YYCURSOR;
yy164:
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy163;
	case ':':	goto yy196;
	default:	goto yy81;
	}
yy165:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy166;
	}
yy166:
#line 78 "lua-parser.re2c"
	{ return TK_AND; }
#line 1423 "lua-parser.re2c.c"
yy167:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'a':	goto yy197;
	default:	goto yy49;
	}
yy168:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy198;
	default:	goto yy49;
	}
yy169:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy170;
	}
yy170:
#line 83 "lua-parser.re2c"
	{ return TK_END; }
#line 1507 "lua-parser.re2c.c"
yy171:
	yych = *++YYCURSOR;
	switch (yych) {
	case 's':	goto yy200;
	default:	goto yy49;
	}
yy172:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy173;
	}
yy173:
#line 85 "lua-parser.re2c"
	{ return TK_FOR; }
#line 1585 "lua-parser.re2c.c"
yy174:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'c':	goto yy201;
	default:	goto yy49;
	}
yy175:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy202;
	default:	goto yy49;
	}
yy176:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'a':	goto yy204;
	default:	goto yy49;
	}
yy177:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy178;
	}
yy178:
#line 91 "lua-parser.re2c"
	{ return TK_NIL; }
#line 1675 "lua-parser.re2c.c"
yy179:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy180;
	}
yy180:
#line 92 "lua-parser.re2c"
	{ return TK_NOT; }
#line 1747 "lua-parser.re2c.c"
yy181:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy205;
	default:	goto yy49;
	}
yy182:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'u':	goto yy206;
	default:	goto yy49;
	}
yy183:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy207;
	default:	goto yy49;
	}
yy184:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy209;
	default:	goto yy49;
	}
yy185:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'i':	goto yy211;
	default:	goto yy49;
	}
yy186:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy212;
	default:	goto yy49;
	}
yy187:
	++YYCURSOR;
#line 74 "lua-parser.re2c"
	{ long_start_line = s->line; nest_count=0; quote_size = ((int)(s->cur - s->top)) - 2;  goto LongComment; }
#line 1788 "lua-parser.re2c.c"
yy189:
	++YYCURSOR;
#line 152 "lua-parser.re2c"
	{ return TK_NUMBER; }
#line 1793 "lua-parser.re2c.c"
yy191:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'L':	goto yy213;
	default:	goto yy81;
	}
yy192:
	yych = *++YYCURSOR;
	switch (yych) {
	case '+':
	case '-':	goto yy214;
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy215;
	default:	goto yy81;
	}
yy193:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'L':	goto yy191;
	default:	goto yy81;
	}
yy194:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy213;
	default:	goto yy81;
	}
yy195:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy194;
	default:	goto yy81;
	}
yy196:
	yych = *++YYCURSOR;
	switch (yych) {
	case ':':	goto yy217;
	default:	goto yy81;
	}
yy197:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'k':	goto yy219;
	default:	goto yy49;
	}
yy198:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	case 'i':	goto yy221;
	default:	goto yy199;
	}
yy199:
#line 81 "lua-parser.re2c"
	{ return TK_ELSE; }
#line 1918 "lua-parser.re2c.c"
yy200:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy222;
	default:	goto yy49;
	}
yy201:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy224;
	default:	goto yy49;
	}
yy202:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy203;
	}
yy203:
#line 121 "lua-parser.re2c"
	{ return TK_GOTO; }
#line 2002 "lua-parser.re2c.c"
yy204:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy225;
	default:	goto yy49;
	}
yy205:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'a':	goto yy227;
	default:	goto yy49;
	}
yy206:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'r':	goto yy228;
	default:	goto yy49;
	}
yy207:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy208;
	}
yy208:
#line 96 "lua-parser.re2c"
	{ return TK_THEN; }
#line 2092 "lua-parser.re2c.c"
yy209:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy210;
	}
yy210:
#line 97 "lua-parser.re2c"
	{ return TK_TRUE; }
#line 2164 "lua-parser.re2c.c"
yy211:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'l':	goto yy229;
	default:	goto yy49;
	}
yy212:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'e':	goto yy231;
	default:	goto yy49;
	}
yy213:
	++YYCURSOR;
	goto yy162;
yy214:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy215;
	default:	goto yy81;
	}
yy215:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':	goto yy215;
	default:	goto yy162;
	}
yy217:
	++YYCURSOR;
#line 123 "lua-parser.re2c"
	{ return TK_LABEL; }
#line 2214 "lua-parser.re2c.c"
yy219:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy220;
	}
yy220:
#line 79 "lua-parser.re2c"
	{ return TK_BREAK; }
#line 2286 "lua-parser.re2c.c"
yy221:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'f':	goto yy233;
	default:	goto yy49;
	}
yy222:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy223;
	}
yy223:
#line 84 "lua-parser.re2c"
	{ return TK_FALSE; }
#line 2364 "lua-parser.re2c.c"
yy224:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'i':	goto yy235;
	default:	goto yy49;
	}
yy225:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy226;
	}
yy226:
#line 90 "lua-parser.re2c"
	{ return TK_LOCAL; }
#line 2442 "lua-parser.re2c.c"
yy227:
	yych = *++YYCURSOR;
	switch (yych) {
	case 't':	goto yy236;
	default:	goto yy49;
	}
yy228:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy238;
	default:	goto yy49;
	}
yy229:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy230;
	}
yy230:
#line 98 "lua-parser.re2c"
	{ return TK_UNTIL; }
#line 2526 "lua-parser.re2c.c"
yy231:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy232;
	}
yy232:
#line 99 "lua-parser.re2c"
	{ return TK_WHILE; }
#line 2598 "lua-parser.re2c.c"
yy233:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy234;
	}
yy234:
#line 82 "lua-parser.re2c"
	{ return TK_ELSEIF; }
#line 2670 "lua-parser.re2c.c"
yy235:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'o':	goto yy240;
	default:	goto yy49;
	}
yy236:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy237;
	}
yy237:
#line 94 "lua-parser.re2c"
	{ return TK_REPEAT; }
#line 2748 "lua-parser.re2c.c"
yy238:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy239;
	}
yy239:
#line 95 "lua-parser.re2c"
	{ return TK_RETURN; }
#line 2820 "lua-parser.re2c.c"
yy240:
	yych = *++YYCURSOR;
	switch (yych) {
	case 'n':	goto yy241;
	default:	goto yy49;
	}
yy241:
	yych = *++YYCURSOR;
	switch (yych) {
	case '0':
	case '1':
	case '2':
	case '3':
	case '4':
	case '5':
	case '6':
	case '7':
	case '8':
	case '9':
	case 'A':
	case 'B':
	case 'C':
	case 'D':
	case 'E':
	case 'F':
	case 'G':
	case 'H':
	case 'I':
	case 'J':
	case 'K':
	case 'L':
	case 'M':
	case 'N':
	case 'O':
	case 'P':
	case 'Q':
	case 'R':
	case 'S':
	case 'T':
	case 'U':
	case 'V':
	case 'W':
	case 'X':
	case 'Y':
	case 'Z':
	case '_':
	case 'a':
	case 'b':
	case 'c':
	case 'd':
	case 'e':
	case 'f':
	case 'g':
	case 'h':
	case 'i':
	case 'j':
	case 'k':
	case 'l':
	case 'm':
	case 'n':
	case 'o':
	case 'p':
	case 'q':
	case 'r':
	case 's':
	case 't':
	case 'u':
	case 'v':
	case 'w':
	case 'x':
	case 'y':
	case 'z':	goto yy48;
	default:	goto yy242;
	}
yy242:
#line 86 "lua-parser.re2c"
	{ return TK_FUNCTION; }
#line 2898 "lua-parser.re2c.c"
}
#line 169 "lua-parser.re2c"


LongString:
  long_top = s->cur;


#line 2907 "lua-parser.re2c.c"
{
	YYCTYPE yych;
	yych = *YYCURSOR;
	switch (yych) {
	case 0x00:	goto yy245;
	case '\n':	goto yy249;
	case '[':	goto yy251;
	case ']':	goto yy252;
	default:	goto yy247;
	}
yy245:
	++YYCURSOR;
#line 183 "lua-parser.re2c"
	{ fprintf(stderr, "unfinished long string at line %d\n", long_start_line); exit(1);}
#line 2922 "lua-parser.re2c.c"
yy247:
	++YYCURSOR;
yy248:
#line 182 "lua-parser.re2c"
	{ goto LongString; }
#line 2928 "lua-parser.re2c.c"
yy249:
	++YYCURSOR;
#line 180 "lua-parser.re2c"
	{ processNewLine(s); goto LongString; }
#line 2933 "lua-parser.re2c.c"
yy251:
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy253;
	case '[':	goto yy256;
	default:	goto yy248;
	}
yy252:
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy258;
	case ']':	goto yy260;
	default:	goto yy248;
	}
yy253:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy253;
	case '[':	goto yy256;
	default:	goto yy255;
	}
yy255:
	YYCURSOR = YYMARKER;
	goto yy248;
yy256:
	++YYCURSOR;
#line 176 "lua-parser.re2c"
	{ int qsz = (int)(s->cur - long_top); if(qsz == quote_size) nest_count++; goto LongString; }
#line 2962 "lua-parser.re2c.c"
yy258:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy258;
	case ']':	goto yy260;
	default:	goto yy255;
	}
yy260:
	++YYCURSOR;
	YYCURSOR -= 1;
#line 177 "lua-parser.re2c"
	{ int qsz = (int)(s->cur+1 - long_top); if( (nest_count == 0) && (qsz == quote_size)) { if(*s->cur == '\n') processNewLine(s); ++s->cur; return TK_LONGSTRING; };
                          if(qsz == quote_size) nest_count--; goto LongString; }
#line 2976 "lua-parser.re2c.c"
}
#line 185 "lua-parser.re2c"


Comment:


#line 2984 "lua-parser.re2c.c"
{
	YYCTYPE yych;
	yych = *YYCURSOR;
	switch (yych) {
	case 0x00:	goto yy265;
	case '\n':	goto yy264;
	default:	goto yy267;
	}
yy264:
#line 191 "lua-parser.re2c"
	{ return TK_COMMENT; }
#line 2996 "lua-parser.re2c.c"
yy265:
	++YYCURSOR;
#line 192 "lua-parser.re2c"
	{ goto regular; }
#line 3001 "lua-parser.re2c.c"
yy267:
	yych = *++YYCURSOR;
	switch (yych) {
	case 0x00:
	case '\n':	goto yy264;
	default:	goto yy267;
	}
}
#line 194 "lua-parser.re2c"


LongComment:
  long_top = s->cur;


#line 3017 "lua-parser.re2c.c"
{
	YYCTYPE yych;
	yych = *YYCURSOR;
	switch (yych) {
	case 0x00:	goto yy271;
	case '\n':	goto yy275;
	case '[':	goto yy277;
	case ']':	goto yy278;
	default:	goto yy273;
	}
yy271:
	++YYCURSOR;
#line 207 "lua-parser.re2c"
	{ fprintf(stderr, "unfinished long comment at line %d\n", long_start_line); exit(1);}
#line 3032 "lua-parser.re2c.c"
yy273:
	++YYCURSOR;
yy274:
#line 206 "lua-parser.re2c"
	{ goto LongComment; }
#line 3038 "lua-parser.re2c.c"
yy275:
	++YYCURSOR;
#line 205 "lua-parser.re2c"
	{ processNewLine(s); goto LongComment; }
#line 3043 "lua-parser.re2c.c"
yy277:
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy279;
	case '[':	goto yy282;
	default:	goto yy274;
	}
yy278:
	yych = *(YYMARKER = ++YYCURSOR);
	switch (yych) {
	case '=':	goto yy284;
	case ']':	goto yy286;
	default:	goto yy274;
	}
yy279:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy279;
	case '[':	goto yy282;
	default:	goto yy281;
	}
yy281:
	YYCURSOR = YYMARKER;
	goto yy274;
yy282:
	++YYCURSOR;
#line 201 "lua-parser.re2c"
	{ int qsz = (int)(s->cur - long_top); if(qsz == quote_size) nest_count++; goto LongComment; }
#line 3072 "lua-parser.re2c.c"
yy284:
	yych = *++YYCURSOR;
	switch (yych) {
	case '=':	goto yy284;
	case ']':	goto yy286;
	default:	goto yy281;
	}
yy286:
	++YYCURSOR;
	YYCURSOR -= 1;
#line 202 "lua-parser.re2c"
	{ int qsz = (int)(s->cur+1 - long_top); if( (nest_count == 0) && (qsz == quote_size)) { if(*s->cur == '\n') processNewLine(s); ++s->cur; return TK_LONGCOMMENT; };
                          if(qsz == quote_size) nest_count--; goto LongComment; }
#line 3086 "lua-parser.re2c.c"
}
#line 209 "lua-parser.re2c"


  fprintf(stderr, "impossible"); exit(1);/* die */
}

static LuaParserToken *pushToken(LuaParserState *pState, LuaScanner *scanner, int token_id) {
  LuaParserToken* token_value = malloc(sizeof(*token_value));
  token_value->flags = 0;
  token_value->token_id = token_id;
  if(scanner->last_top != scanner->top) {
    token_value->space_before_size = (int)(scanner->top - scanner->last_top);
    token_value->space_before_pos = (int)(scanner->last_top - pState->src);
  }
  else {
    token_value->space_before_size = 0;
    token_value->space_before_pos = 0;
  }
  scanner->last_top = scanner->cur;
  token_value->token_value_size = (int)(scanner->cur - scanner->top);
  token_value->token_value =  scanner->top;
  pushLuaParserToken(pState, token_value);
  return token_value;
}

int main(int argc, char *argv[]) {

  FILE *fp, *traceFile;
  long size;
  char *buff, *buff_end;
  size_t bytes;
  int token;
  LuaScanner scanner;
  LuaParserState parser_state;
  void *parser;
  //ParserCount pCount;

  int fn_argc = 1;
  int noToCompound = 0;
  int withTrace = 0;
  if(argc > 2) {
    for(; fn_argc < (argc-1); ++fn_argc) {
      if (strcmp(argv[fn_argc] , "-nc") == 0) noToCompound = 1;
#ifndef NDEBUG
      else if (strcmp(argv[fn_argc] , "-t") == 0) withTrace = 1;
#endif
      else {
        printf("usage : %s [options] lua_fname\n\toptions:\n\t\t-nc\tdo not convert to compound assginments\n"
#ifndef NDEBUG
                 "\t\t-t\tgenerate parser trace\n"
#endif
	    , argv[0]);
        exit(1);
    }
   }
  }

  /* Open input file */
  const char *fname = "test.lua";
  if(argc > 1) fname = argv[fn_argc];
  fp = fopen(fname, "r");
  if(fp == NULL) {
    fprintf(stderr, "Can't open test file\n");
    exit(-1);
  }

  if(withTrace) {
	/* Open trace file */
	traceFile = fopen("trace.out", "w");
	if(traceFile == NULL) {
	    fprintf(stderr, "Can't open trace file\n");
	    exit(-1);
	}
  }

  /* Get file size */
  fseek(fp, 0, SEEK_END);
  size = ftell(fp);
  rewind(fp);

  /*We only manage sources smaller than INT_MAX size */
  if(size > INT_MAX) {
    printf("Error file size bigger than %d\n", INT_MAX);
    exit(1);
  }

  /*
  * Allocate buffer and read, +2 just in case file do not end in '\n'
  */
  buff = (char*) malloc((size+2) * sizeof(char));
  bytes = fread(buff, 1, size, fp);
  if (bytes != size) {
    fprintf(stderr, "Error reading input file\n");
    exit(-1);
  }
  buff[size] = '\0';

  if(size > 1 && buff[size-1] != '\n') {
    /* to make things easy to parse we need a '\n' at the end */
    buff[size] = '\n';
    buff[size+1] = '\0';
    ++size;
  }

  /* Initialize scanner */
  scanner.line = 1;
  scanner.top = scanner.last_top = buff;
  scanner.cur = buff;
  scanner.pos = buff;
  scanner.ptr = buff;
  scanner.limit = buff+size;
#ifndef NDEBUG
   snprintf(scanner.parsePrompt, sizeof(scanner.parsePrompt), "parser %d >>", scanner.line);
#endif

  /* Initialize parser state */
  initializeLuaParserState(&parser_state);
  parser_state.src = buff;
  parser_state.noToCompound = noToCompound;

  /* Initialize the parser state structure */
  //pCount.numFunctionDefinitions = 0;
  //pCount.numVariableDeclarations = 0;

  /* Pointer to the end of the buffer */
  buff_end = (char*) (((char*)buff) + size);

  /* Create parser and set up tracing */
  parser = LuaParserAlloc(malloc);
#ifndef NDEBUG
  if(withTrace) LuaParserTrace(traceFile, scanner.parsePrompt);
#endif

  //printf("%d:%d:%d:%d\n", TK_SPACE, TK_COMMENT, TK_LONGCOMMENT, TK_THEEND);
  while((token = scan(&scanner, buff_end))) {
    if(token != TK_THEEND) {
      LuaParserToken *token_value = pushToken(&parser_state, &scanner, token);
      //printf("\n==++== %d : %d : %.8s\n", scanner.line, token, scanner.top);

      if(token < TK_LEMON_LAST_TOKEN) {
        LuaParser(parser, token, token_value, &parser_state);
      }
      else //SpecialTokens
      {
        //size_t gap_length = scanner.cur - scanner.top;
        switch(token) {
          case TK_SPACE:
            //printf("=S=%.*s=S=\n", (int)gap_length, scanner.top);
          break;
          case TK_COMMENT:
            //printf("=C=%.*s=C=\n", (int)gap_length, scanner.top);
            newStrFmt(token_value, "//%.*s", token_value->token_value_size-2, token_value->token_value+2);
          break;
          case TK_LONGCOMMENT: {
            //printf("=LC=%.*s=LC=\n", (int)gap_length, scanner.top);
            int quote_end = 4; // "--[["
            while(token_value->token_value[quote_end-1] != '[') ++quote_end; //try to find the end
            newStrFmt(token_value, "/*%.*s*/", token_value->token_value_size - quote_end - (quote_end-2), // -2 for "--"
                                                                  token_value->token_value + quote_end);
          }
          break;
        }
      }
    }
    else {
      if(scanner.last_top < buff_end) pushToken(&parser_state, &scanner, TK_SPACE);
      // Execute Parse for the last time
      LuaParser(parser, 0, NULL, &parser_state);
      break;
    }
  }
  /* Print results of parsing */
  //printf("Number of function definitions: %d.\n", pCount.numFunctionDefinitions);
  //printf("Number of variable declarations: %d.\n", pCount.numVariableDeclarations);

  /* output the reconstruction */
  doOutput(&parser_state);

  /* Deallocate parser */
  LuaParserFree(parser, free);

  resetLuaParserState(&parser_state);

  /* Close files and deallocate */
  fclose(fp);
 if(withTrace)  fclose(traceFile);
  free(buff);
  return(0);
}
